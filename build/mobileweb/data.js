// Generated by CoffeeScript 1.3.3
(function() {

  (function() {
    var factory, name;
    name = "stData";
    factory = function(exports) {
      var MONTH_MAP, RSS_URL, getElementChild, getElementText, parseDate;
      RSS_URL = "http://www.startribune.com/local/index.rss2";
      MONTH_MAP = {
        JAN: 1,
        FEB: 2,
        MAR: 3,
        APR: 4,
        MAY: 5,
        JUN: 6,
        JUL: 7,
        AUG: 8,
        SEP: 9,
        OCT: 10,
        NOV: 11,
        DEC: 12
      };
      parseDate = function(dateString) {
        var dateParts, out, timeParts;
        dateParts = dateString.split(' ');
        timeParts = dateParts[4].split(':');
        out = MONTH_MAP[dateParts[2].toUpperCase()];
        out += '/' + dateParts[1] + ' ';
        out += timeParts[0] + ':' + timeParts[1];
        return out;
      };
      getElementChild = function(element, tagName) {
        return element != null ? element.getElementsByTagName(tagName).item(0) : void 0;
      };
      getElementText = function(element) {
        var text;
        text = element.textContent;
        if (text == null) {
          text = element.text;
        }
        return text;
      };
      return exports.getRSS = function(callback) {
        var xhr;
        xhr = Titanium.Network.createHTTPClient();
        xhr.open('GET', RSS_URL);
        xhr.onload = function(e) {
          var data, dateString, item, items, xml, _i, _len;
          xml = this.responseXML;
          items = xml.documentElement.getElementsByTagName("item");
          data = [];
          for (_i = 0, _len = items.length; _i < _len; _i++) {
            item = items[_i];
            dateString = getElementText(getElementChild(item, 'date'));
            data.push({
              title: getElementText(getElementChild(item, 'title')),
              link: getElementText(getElementChild(item, 'link')),
              description: getElementText(getElementChild(item, 'description')),
              pubDate: new Date(dateString)
            });
          }
          if (callback != null) {
            return callback(data);
          }
        };
        xhr.onerror = function(e) {
          console.error('error');
          if (callback != null) {
            return callback();
          }
        };
        return xhr.send();
      };
    };
    switch (true) {
      case typeof exports !== "undefined" && exports !== null:
        return factory(exports);
      case typeof global !== "undefined" && global !== null:
        global[name] = {};
        return factory(global[name]);
      case typeof window !== "undefined" && window !== null:
        window[name] = {};
        return factory(window[name]);
    }
  })();

  /*
  Example of the RSS feed XML structure:
  
  <?xml version="1.0" encoding="utf-8"?>
  <rss xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:taxo="http://purl.org/rss/1.0/modules/taxonomy/" version="2.0">
  <channel>
  <title>StarTribune.com | Local News</title>
  <link>http://www.startribune.com/local</link>
  <description>RSS Feed for Local</description>
  <language>en-us</language>
  <pubDate>Mon, 04 Jun 2012 20:30:09 GMT</pubDate>
  <dc:date>2012-06-04T20:30:09Z</dc:date>
  <dc:language>en-us</dc:language>
  <item>
  <title>Casual Minnesota vetting allowed tutor vendors to slip through</title>
  <link>http://www.startribune.com/local/156921365.html</link>
  <description>Minnesota's relaxed attitude in regulating the government's tutoring program burdened school districts with questionable companies.</description>
  <pubDate>Mon, 04 Jun 2012 20:00:09 GMT</pubDate>
  <guid>http://www.startribune.com/local/156921365.html</guid>
  <dc:date>2012-06-04T20:00:09Z</dc:date>
  </item>
  ...
  */


}).call(this);
